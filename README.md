# Ember Fixture Problem

This repository was created to demonstrate a specific problem in ember acceptance tests using a project created with ember-cli.

The ```navigate``` test fails 50% of the time: if this test is run first, it passes. If it is run after the ```visit \``` test, it fails.

The problem is that the generated ```teardown``` method in nodes/index-test calls ```App.destroy```, which sets the ```__ember_meta__``` property of each cached ```Node``` record to null, and when the next test runs Ember attempts to render this destroyed record and cannot retrieve the property values from it, rendering a blank DIV in this case, when the string "a.a" is expected. The test starts on the index page then navigates to the node page, and attempts to assert that the content of the h1 is "a.a". When the ```visit \``` test is run first, it loads the fixture data, then the teardown method "destroys" the ```Node``` records but leaves them in memory, then the ```navigate``` test runs, and it fails because the underlying records have been destroyed (they have a null ```__ember_meta__``` property).

I believe this fails in my case because I have a ```DS.hasMany``` relationship on the Node model, and the objects in the ```children``` collection are destroyed (but not removed) and are unrenderable by the next test. I believe this problem applies to projects with models containing a ```DS.hasMany``` relationship, use the FixtureAdapter, and have multiple acceptance tests with one that visits the parent view and navigates to the child.

Ultimately I feel that ember-cli should to generate acceptance tests that are not susceptible to this problem. It is worth considering a modification to the acceptance-test generator that would generate logic to reset the fixtures in the setup or teardown. However, I'm not sure if this is a problem best addressed in ember-cli, ember-data, or ember. It would be nice if ```App.reset``` reset ```FIXTURES```, then the acceptance tests generated by ember-cli wouldn't need to change at all. 


## Installation

* `git clone` this repository
* `npm install`
* `bower install`

## Running

* `ember server`
* Visit your app at http://localhost:4200.

## Running Tests

* `ember test`
* `ember test --server`

## Building

* `ember build`

For more information on using ember-cli, visit [http://iamstef.net/ember-cli/](http://iamstef.net/ember-cli/).
